# ADR: Distribuci√≥n ‚Äî PWA vs App Nativa

**ID**: ADR-0011
**Fecha**: 2026-02-15
**Estado**: üü¢ Aceptado
**Autor**: Claude / Aritz

## 1. Contexto y Problema

Los opositores estudian en cualquier lugar: casa, biblioteca, transporte p√∫blico, cafeter√≠a. Necesitan acceso desde m√≥vil (uso principal), tablet y desktop. La app debe ser instalable, tener carga r√°pida, y funcionar con conexiones intermitentes. Debemos decidir entre una Progressive Web App (PWA) o una app nativa (React Native, Flutter, Swift/Kotlin).

## 2. Opciones Consideradas

- **Opci√≥n A**: PWA (Progressive Web App) ‚Äî App web que se instala desde el navegador. Service Worker para caching/offline, Web App Manifest para icono en homescreen. Un solo codebase para todas las plataformas.
- **Opci√≥n B**: React Native (Expo) ‚Äî App nativa compilada para iOS/Android desde JavaScript/React. Distribuci√≥n v√≠a App Store / Google Play. Requiere codebase separado (o shared con monorepo).
- **Opci√≥n C**: Flutter ‚Äî App nativa compilada para iOS/Android/Web desde Dart. Excelente rendimiento UI pero stack completamente diferente (Dart, no TypeScript).
- **Opci√≥n D**: App nativa pura (Swift + Kotlin) ‚Äî M√°ximo rendimiento y acceso a APIs nativas. Requiere 2 codebases y 2 equipos.

## 3. Decisi√≥n Elegida: PWA

**Justificaci√≥n T√©cnica**:

1. **Un solo codebase**: Next.js genera la PWA directamente. No hay codebase nativo separado. Para un equipo de 1-2 personas, mantener 1 codebase vs 2-3 es la diferencia entre viable e inviable.
2. **Sin App Store**: No necesitamos review de Apple (1-7 d√≠as), no pagamos $99/a√±o de Apple Developer, no pagamos 15-30% de comisi√≥n sobre in-app purchases. Los pagos van directamente por Stripe web.
3. **Distribuci√≥n instant√°nea**: Deploy = users actualizado. Sin proceso de release en stores, sin fragmentaci√≥n de versiones, sin "por favor actualice la app".
4. **Instalable**: `next-pwa` genera manifest.json + Service Worker. Los usuarios pueden "A√±adir a pantalla de inicio" y la app se comporta como nativa (sin barra de navegador, splash screen, icono).
5. **Offline parcial**: Service Worker cachea assets est√°ticos, shell de la app, y tests ya generados. Los usuarios pueden revisar tests anteriores sin conexi√≥n. La generaci√≥n de nuevos tests requiere conexi√≥n (Claude API).
6. **Coste reducido**: $0 extra en distribuci√≥n. No App Store fees, no React Native/Flutter expertise necesario.
7. **SEO**: La landing page, pricing, y contenido p√∫blico son indexables por Google. Una app nativa no tiene SEO.

## 4. Consecuencias (Trade-offs)

- **Positivas**: Un solo codebase, distribuci√≥n instant√°nea, sin comisiones de stores, SEO, coste de desarrollo m√≠nimo, actualizaci√≥n sin friction.
- **Negativas/Riesgos**:
  - **iOS limitaciones**: Safari no soporta push notifications en PWA hasta iOS 16.4+. Service Worker storage puede ser purgado por iOS tras 7 d√≠as sin uso. Mitigaci√≥n: nuestro target usa la app regularmente (estudiantes activos) y iOS 16.4+ es >90% del mercado iOS.
  - **Sin App Store presence**: Los usuarios no pueden descubrir la app en stores. Mitigaci√≥n: la adquisici√≥n es via web (Google, redes sociales, foros de opositores), no via stores. Opositores buscan en Google "preparar oposiciones", no en App Store.
  - **No acceso a APIs nativas avanzadas**: No Bluetooth, NFC, ARKit, etc. Mitigaci√≥n: no necesitamos ninguna de estas para nuestra funcionalidad (texto, audio web API s√≠ disponible).
  - **Grabaci√≥n de audio**: Web Audio API / MediaRecorder API soportados en navegadores modernos, suficiente para evaluaci√≥n oral (Fase 2B). Si la calidad es insuficiente, reconsiderar React Native para Fase 3.

## 5. Notas de Implementaci√≥n

- Configurar `next-pwa` en `next.config.js` con: scope, startUrl, display: "standalone", theme_color: "#1B4F72".
- Service Worker strategy: NetworkFirst para API calls, CacheFirst para assets est√°ticos.
- Manifest: icons en m√∫ltiples tama√±os (192x192, 512x512), screenshots para install prompt.
- Prompt de instalaci√≥n: banner custom en primera visita con instrucciones "A√±adir a pantalla de inicio".
- Offline: cachear shell de la app + tests ya completados en IndexedDB.
- Testing: Lighthouse PWA audit como parte del CI (target score: 90+).
- **Punto de reevaluaci√≥n**: Si en Fase 2B la grabaci√≥n de audio via Web API no cumple requisitos de calidad, crear ADR para React Native wrapper.
