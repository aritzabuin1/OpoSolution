# ADR: Framework Frontend ‚Äî Next.js 14 App Router

**ID**: ADR-0006
**Fecha**: 2026-02-15
**Estado**: üü¢ Aceptado
**Autor**: Claude / Aritz

## 1. Contexto y Problema

OPTEK necesita un framework web que soporte: Server-Side Rendering (SEO para landing/pricing), API routes para backend (Claude, Stripe, webhooks), autenticaci√≥n server-side, streaming responses (para output de Claude en tiempo real), y capacidad PWA. El framework debe ser productivo para un equipo peque√±o (1-2 desarrolladores) y tener ecosistema maduro.

## 2. Opciones Consideradas

- **Opci√≥n A**: Next.js 14 (App Router) ‚Äî Framework React full-stack de Vercel. App Router con React Server Components, Server Actions, streaming, middleware. Ecosistema masivo, deploy nativo en Vercel.
- **Opci√≥n B**: Remix ‚Äî Framework React con loader/action pattern. Excelente en manejo de formularios y datos. Menor ecosistema que Next.js.
- **Opci√≥n C**: SvelteKit ‚Äî Framework Svelte. Excelente rendimiento y DX, pero ecosistema menor y menor pool de desarrolladores.
- **Opci√≥n D**: Astro + React islands ‚Äî Excelente para contenido est√°tico con islas interactivas. Menos adecuado para apps full-stack con mucha interactividad.

## 3. Decisi√≥n Elegida: Next.js 14 App Router

**Justificaci√≥n T√©cnica**:

1. **React Server Components**: Permiten renderizar la legislaci√≥n y estructura de tests en el servidor, enviando solo HTML al cliente. Reduce el JS bundle significativamente.
2. **Streaming nativo**: `ReadableStream` en API routes + React Suspense permiten mostrar el output de Claude token a token mientras se genera. Cr√≠tico para UX en generaci√≥n de tests (~3-5s).
3. **API Routes**: Endpoints serverless para Claude API, Stripe webhooks, y BOE monitor. Sin necesidad de backend separado.
4. **Middleware**: Autenticaci√≥n server-side con Supabase en el edge, protecci√≥n de rutas sin client-side flash.
5. **Deploy en Vercel**: Deploy autom√°tico desde GitHub, preview deployments para PRs, edge functions, analytics, instant rollback. Infraestructura zero-config.
6. **Ecosistema**: shadcn/ui, next-pwa, @supabase/ssr, @sentry/nextjs ‚Äî todas librer√≠as first-class para Next.js.
7. **PWA**: `next-pwa` permite Service Worker + manifest.json para instalaci√≥n en m√≥vil, que es nuestro target principal (opositores estudiando en el m√≥vil).
8. **SEO**: Landing page y pricing renderizados server-side para indexaci√≥n en Google.

## 4. Consecuencias (Trade-offs)

- **Positivas**: Productividad m√°xima para equipo peque√±o, deploy zero-config en Vercel, streaming de Claude nativo, ecosistema maduro, SEO para landing.
- **Negativas/Riesgos**: Vendor coupling con Vercel para deploy √≥ptimo (mitigado: Next.js se puede deployar en cualquier Node.js, Docker, o Cloudflare). App Router es relativamente nuevo y tiene peculiaridades de caching que requieren atenci√≥n. Bundle size de React es mayor que Svelte (mitigado: RSC reduce el JS enviado al cliente).

## 5. Notas de Implementaci√≥n

- Estructura App Router en `/app` con grupos de rutas: `(auth)`, `(dashboard)`, `(marketing)`.
- Layout compartido con `layout.tsx` para sidebar/navbar en dashboard.
- Middleware de autenticaci√≥n en `/middleware.ts` usando `@supabase/ssr`.
- Streaming en API routes: `return new Response(stream)` con `TextEncoder`.
- PWA config con `next-pwa` en `next.config.js`.
- Tailwind CSS + shadcn/ui para UI consistente y r√°pida de desarrollar.
